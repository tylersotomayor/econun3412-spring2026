----------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/tylersotomayor/econ3412/recitation_05/rec5.log
  log type:  text
 opened on:  23 Feb 2026, 13:11:31

. browse

. use lead_mortality.dta, clear

. browse

. summarize infrate if lead == 0

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     infrate |         55    .3811679    .1477588   .1097561   .7515528

. summarize infrate if lead == 1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     infrate |        117    .4032576    .1530873   .1413613   .8444657

. ttest infrate, by(lead) unequal unpaired

Two-sample t test with unequal variances
------------------------------------------------------------------------------
   Group |     Obs        Mean    Std. err.   Std. dev.   [95% conf. interval]
---------+--------------------------------------------------------------------
       0 |      55    .3811679    .0199238    .1477588     .341223    .4211127
       1 |     117    .4032576    .0141529    .1530873    .3752259    .4312892
---------+--------------------------------------------------------------------
Combined |     172     .396194    .0115384    .1513249    .3734179    .4189701
---------+--------------------------------------------------------------------
    diff |           -.0220897     .024439               -.0705255    .0263461
------------------------------------------------------------------------------
    diff = mean(0) - mean(1)                                      t =  -0.9039
H0: diff = 0                     Satterthwaite's degrees of freedom =  109.292

    Ha: diff < 0                 Ha: diff != 0                 Ha: diff > 0
 Pr(T < t) = 0.1840         Pr(|T| > |t|) = 0.3681          Pr(T > t) = 0.8160

. generate lead_ph = lead * ph

. regress infrate lead ph lead_ph, robust

Linear regression                               Number of obs     =        172
                                                F(3, 168)         =      20.97
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2719
                                                Root MSE          =     .13027

------------------------------------------------------------------------------
             |               Robust
     infrate | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        lead |   .4617985   .2076136     2.22   0.027     .0519309    .8716661
          ph |  -.0751792   .0209532    -3.59   0.000    -.1165447   -.0338136
     lead_ph |  -.0568622   .0280837    -2.02   0.044    -.1123047   -.0014197
       _cons |   .9189038   .1504941     6.11   0.000     .6218005    1.216007
------------------------------------------------------------------------------

. test lead lead_ph

 ( 1)  lead = 0
 ( 2)  lead_ph = 0

       F(  2,   168) =    3.94
            Prob > F =    0.0214

. summarize ph

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
          ph |        172    7.322674    .6917288        5.7        8.9

. do "/Users/tylersotomayor/dataverse_files/exhibit_replication/code/draw_paper_figs_tabs.do"

. *********************************
. * Paper Figure and Table Creation
. *********************************
. set more off

. 
. * Set to replication folder location
. global replication_folder "/Users/tylersotomayor/dataverse_files/exhibit_replication"

. 
. 
. * Run metafile
. do "${replication_folder}/code/header.do"

. 
. *************************************
. * Metafile - College Paper
. *************************************
. set more off

. set matsize 800
set matsize ignored.
    Matrix sizes are no longer limited by c(matsize) in modern Statas.  Matrix sizes are now limited by edition of Stata.  See limits for
    more details.

. 
. 
. global root "${replication_folder}"  

. 
. 
. *************
. * Code
. *************
. global code ${root}/code

. global fig_code ${code}/figures

. global tab_code ${code}/tables

. 
. *************
. * Output
. *************
. * Figures output directory
. global output ${root}/output

. global figs ${output}/figures

. global tabs ${output}/tables

. 
. *************
. * Input
. *************
. global input ${root}/input

. 
. * Published online datatables
. global data ${input}/online_tables

. * Figure replication input
. global rep_data ${input}/replication

. 
. 
. * College collapse
. global college_collapse "${data}/mrc_table2.dta" 

. 
. * College collapse by tax year
. global college_taxyr "${data}/mrc_table3.dta" 

. 
. * College collapse robustness checks
. global robustness "${data}/mrc_table4.dta"

. 
. * Table 5: Robustness by Cohort
. global robustness_cohort "${data}/mrc_table5.dta"

. 
. * Tier-Paragi - pooled
. global tier_paragi_pooled "${data}/mrc_table6.dta"

. 
. * Tier kid-wagse 
. global tier_kid_pooled "${data}/mrc_table7.dta"

. 
. * Paragi tier by cohort - quintile
. global tier_paragi_cohort "${data}/mrc_table8.dta"

. 
. * Cutoffs
. global cutoffs "${data}/mrc_table9.dta"

. 
. * College Covariates 
. global covariates "${data}/mrc_table10.dta"

. 
. * OPEID - Super-OPEID crosswalk
. global cross "${data}/mrc_table11.dta"

. 
. * Normed Parent Income and Mobility Rate Estimates
. global normed "${data}/mrc_table14.dta"

. 
. * Close Super-OPEIDs
. global closed_supers "${data}/mrc_table15.dta"

. 
. 
. 
. * Counterfactuals
. global cbaa_adj 160

. 
end of do-file

. 
. * Figure output extension 
. global image_suffix pdf

. 
. 
. ********************************************************************************
. * Main Figures
. ********************************************************************************
. * Figure 1
. // panel A is constructed directly from the individual-level microdata
. do "$fig_code/paper_fig_1.do"

. * Parental Income and College Attendance
. 
. 
. ************************************************************
. * Panel A: College Attendance by Parent Income Percentile
. ************************************************************
. 
. use ${rep_data}/paper_fig_1a  , clear

. 
. * Produce and export graph.
. #delimit ;
delimiter now ;
. twoway (scatter cg22_80 par_agi, c(l) msize(small))  
>            ,
>         legend(off)
>         xtitle("Parent Rank") 
>         ytitle("Percentage Attended College") 
>         ylabel(0(20)100) 
>         title(" ")
>         ;

. #delimit cr
delimiter now cr
. graph export "${figs}/paper_fig_1a.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_1a.pdf saved as PDF format

. 
. gen quint = floor(par_agi_pctile/20) + 1

. collapse (mean) cg22_80, by(quint)

. list

     +------------------+
     | quint    cg22_80 |
     |------------------|
  1. |     1   38.41626 |
  2. |     2   49.84114 |
  3. |     3   60.49035 |
  4. |     4   72.65778 |
  5. |     5   87.76942 |
     +------------------+

. 
. ************************************************************
. * Panel B: Distribution of Parent Incomes at Various Schools
. ************************************************************
. 
. use "${college_collapse}", clear
(Baseline Cross-Sectional Estimates by College)

. 
. /* Relevant Super-OPEIDs:
>         * Harvard = 129
>         * UC Berkeley = 1312
>         * SUNY Stony Brook = 2838
>         * Glendale Community College = 1203
> */
. 
. keep name super par_q* par_top1pc

. reshape long par_q, i(super par_top1pc name) j(quintile)
(j = 1 2 3 4 5)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations            2,202   ->   11,010      
Number of variables                   8   ->   5           
j variable (5 values)                     ->   quintile
xij variables:
               par_q1 par_q2 ... par_q5   ->   par_q
-----------------------------------------------------------------------------

. 
. foreach q of varlist par_q* par_top1pc {
  2.         replace `q' = `q'*100
  3. }
(11,010 real changes made)
(10,930 real changes made)

. 
. g xaxis = .
(11,010 missing values generated)

. replace xaxis = quintile - 0.3 if super==129
(5 real changes made)

. replace xaxis = quintile - 0.1 if super==1312
(5 real changes made)

. replace xaxis = quintile + 0.1 if super==2838
(5 real changes made)

. replace xaxis = quintile + 0.3 if super==1203
(5 real changes made)

. 
. replace par_top1pc = . if quintile!=5 
(8,808 real changes made, 8,808 to missing)

.  
. tw (bar par_q xaxis if super==129, color("126 32 57") barw(0.2)) ///
>         (bar par_q xaxis if super==1312, color("85 111 133") barw(0.2)) ///
>         (bar par_q xaxis if super==2838, color("128 157 97") barw(0.2)) ///
>         (bar par_q xaxis if super==1203, color("244 203 154") barw(0.2)) ///
>         (bar par_top1 xaxis if super==129, color("126 32 57") fi(50) barw(0.2)) ///
>         (bar par_top1 xaxis if super==1312, color("85 111 133") fi(50) barw(0.2)) ///
>         (bar par_top1 xaxis if super==2838, color("128 157 97") fi(50) barw(0.2)) ///
>         (bar par_top1 xaxis if super==1203, color("244 203 154") fi(50) barw(0.2)) ///
>         , title(" ") xtitle("Parent Income Quintile") ytitle("Percent of Students") ///
>         legend(order(1 2 3 4) c(1) ring(0) pos(11) region(color(none)) ///
>                 lab(1 "Harvard University") lab(2 "UC Berkeley") ///
>                 lab(3 "SUNY-Stony Brook") lab(4 "Glendale Community College")) ///
>         text(30 4 "Top 1%", size(*1.2))

. graph export "${figs}/paper_fig_1b.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_1b.pdf saved as PDF format

. 
. list name par_top1pc par_q if quintile==5 & inlist(super,129,1312,2838,1203)

       +-------------------------------------------------------------------+
       |                                        name   par_to~c      par_q |
       |-------------------------------------------------------------------|
  345. |                          Harvard University   15.39945   70.25214 |
  975. |                  Glendale Community College   .3114917   13.55972 |
 1155. |          University Of California, Berkeley   4.711709    51.3498 |
 4860. | State University Of New York At Stony Brook   .4420117   30.09373 |
       +-------------------------------------------------------------------+

. 
. ******************************************************
. * Panel C: Parent Income distributions at all Ivy Plus
. ******************************************************
. 
. use "${tier_paragi_pooled}", clear
(Cross-Sectional Statistics by College Tier and Parent Income Percentile )

. keep if tier==1
(1,414 observations deleted)

. drop if par_pctile > 99
(1 observation deleted)

. collapse (rawsum) count, by(par_pctile) 

. egen tot_count = total(count)

. g pct_count = 100*count/tot_count

. 
. sum pct_count if inrange(par_pctile,0,99)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   pct_count |        100           1    1.962999   .1517336     14.519

. local pct_mean = r(mean)

. 
. egen bot20 = total(pct_count) if inrange(par_pctile,0,19)
(80 missing values generated)

. sum bot20

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       bot20 |         20    3.755405           0   3.755405   3.755405

. local b20 : di %3.1f r(mean)

. 
. sum pct_count if par_pctile==99

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   pct_count |          1      14.519           .     14.519     14.519

. local top1 : di %3.1f r(mean)

. 
. tw connect pct_count par_pctile if inrange(par_pctile,0,99), ///
>         msiz(small)  ///
>         title(" ") ytitle("Percent of Students") xtitle("Parent Rank") ///
>         plotregion(margin(b=0)) ///
>         text(3 22 "`b20'% of students from bottom 20%" ///
>                 14 60 "`top1'% of students from top 1%")

. graph export "${figs}/paper_fig_1c.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_1c.pdf saved as PDF format

. 
. 
. 
end of do-file

. 
. * Figure 2 
. // constructed directly from the individual-level microdata
. do "$fig_code/paper_fig_2.do"

. * Income Segregation across Colleges vs. Pre-College Neighborhoods
. 
. 
. * Load data
. use ${rep_data}/paper_fig_2 , clear

. 
. ************************************************************
. * Panel A: Peers of Children from Bottom Quintile
. ************************************************************
. 
. local cond pq==1

. local panel a

. 
. #delimit ;
delimiter now ;
. graph bar (asis) peers_pqResidential peers_pqCollege if `cond',
>           over(parq)
>           ytitle("Share of Peers (%)")
>           b1title("Peers' Parent Income Quintile")
>           bar(1, color("0 32 96")) bar(2, color("169 209 142"))
>           legend(lab(1 "Pre-College Neighborhoods (ZIP Codes)")
>                          lab(2 "Colleges")
>                          row(1) span)
> ;

. #delimit cr
delimiter now cr
. 
. graph export "${figs}/paper_fig_2`panel'.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_2a.pdf saved as PDF format

. 
. ************************************************************
. * Panel B: Peers of Children from Top Quintile
. ************************************************************
. 
. local cond pq==5&ivies==0

. local panel b

. 
. #delimit ;
delimiter now ;
. graph bar (asis) peers_pqResidential peers_pqCollege if `cond',
>           over(parq)
>           ytitle("Share of Peers (%)")
>           b1title("Peers' Parent Income Quintile")
>           bar(1, color("0 32 96")) bar(2, color("169 209 142"))
>           legend(lab(1 "Pre-College Neighborhoods (ZIP Codes)")
>                          lab(2 "Colleges")
>                          row(1) span)
> ;

. #delimit cr
delimiter now cr
. 
. graph export "${figs}/paper_fig_2`panel'.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_2b.pdf saved as PDF format

. 
. ************************************************************
. * Panel C: Peers of Ivy-Plus College Students from Top Quintile
. ************************************************************
. 
. local cond ivies==1

. local panel c

. 
. #delimit ;
delimiter now ;
. graph bar (asis) peers_pqResidential peers_pqCollege if `cond',
>           over(parq)
>           ytitle("Share of Peers (%)")
>           b1title("Peers' Parent Income Quintile")
>           bar(1, color("0 32 96")) bar(2, color("169 209 142"))
>           legend(lab(1 "Pre-College Neighborhoods (ZIP Codes)")
>                          lab(2 "Colleges")
>                          row(1) span)
> ;

. #delimit cr
delimiter now cr
. 
. graph export "${figs}/paper_fig_2`panel'.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_2c.pdf saved as PDF format

. 
end of do-file

. 
. * Figure 3 
. // constructed directly from the individual-level microdata
. do "$fig_code/paper_fig_3.do"

. * Relationship Between Children’s and Parents’ Ranks within Colleges
. 
. ************************************************************
. * Panel A: National Averages
. ************************************************************
. use ${rep_data}/paper_fig_3a , clear

. 
. #delimit ;
delimiter now ;
. tw (scatter coef_noFE par_rank)
>     (lfit coef_noFE par_rank, lcolor(navy))
>     (scatter coef_superFE par_rank, mcolor(cranberry) ms(t))
>     (lfit coef_superFE par_rank, lcolor(cranberry))
>         (scatter coef_supersatFE par_rank, mcolor(dkgreen) ms(s))
>     (lfit coef_supersatFE par_rank, lcolor(dkgreen))
>     ,
>     ytitle("Child Rank")
>     xtitle("Parent Rank")
>     legend( region(color(none)) lab(1 "National (slope: .288)")
>            lab(3 "with College Fixed Effects (slope: .139)")
>                    lab(5 "with College*SAT/ACT Fixed Effects (slope: .125)")
>            row(3) /*span*/ order(1 3 5) lcolor(white)
>                    ring(0) position(4) bmargin(l+4 b+2 r-4))
>         plotregion(fcolor(white) lcolor(white)) graphregion(fcolor(white) lcolor(white))
> ;

. #delimit cr
delimiter now cr
. graph export "${figs}/paper_fig_3a.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_3a.pdf saved as PDF format

. 
. ************************************************************
. * Panel B: Individual-School Binscatter Points
. ************************************************************
. use ${rep_data}/paper_fig_3b , clear

. 
. * Slopes
. reg k_rank par_pctile [w=count]
(analytic weights assumed)
(sum of wgt is 10,757,269)

      Source |       SS           df       MS      Number of obs   =       100
-------------+----------------------------------   F(1, 98)        =  26737.52
       Model |  6927.82749         1  6927.82749   Prob > F        =    0.0000
    Residual |  25.3922958        98  .259105059   R-squared       =    0.9963
-------------+----------------------------------   Adj R-squared   =    0.9963
       Total |  6953.21979        99  70.2345433   Root MSE        =    .50902

------------------------------------------------------------------------------
      k_rank | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
  par_pctile |   .2883462   .0017634   163.52   0.000     .2848468    .2918456
       _cons |   35.72704   .1010459   353.57   0.000     35.52651    35.92756
------------------------------------------------------------------------------

. local nat : di %4.3f _b[par_pctile]

. reg truepts rhs if super==1312 [w=people]
(analytic weights assumed)
(sum of wgt is 13,877)

      Source |       SS           df       MS      Number of obs   =        20
-------------+----------------------------------   F(1, 18)        =     56.70
       Model |  59.9581972         1  59.9581972   Prob > F        =    0.0000
    Residual |  19.0332204        18  1.05740114   R-squared       =    0.7590
-------------+----------------------------------   Adj R-squared   =    0.7457
       Total |  78.9914177        19  4.15744304   Root MSE        =    1.0283

------------------------------------------------------------------------------
     truepts | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         rhs |   .0603728   .0080175     7.53   0.000     .0435288    .0772169
       _cons |   69.38681    .604496   114.78   0.000     68.11681    70.65681
------------------------------------------------------------------------------

. local berk : di %4.3f _b[rhs]

. reg truepts rhs if super==2838 [w=people]
(analytic weights assumed)
(sum of wgt is 6,212)

      Source |       SS           df       MS      Number of obs   =        20
-------------+----------------------------------   F(1, 18)        =      9.54
       Model |  29.0819435         1  29.0819435   Prob > F        =    0.0063
    Residual |  54.8529672        18  3.04738707   R-squared       =    0.3465
-------------+----------------------------------   Adj R-squared   =    0.3102
       Total |  83.9349107        19  4.41762688   Root MSE        =    1.7457

------------------------------------------------------------------------------
     truepts | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         rhs |   .0408234   .0132148     3.09   0.006     .0130601    .0685867
       _cons |   68.40485   .8397234    81.46   0.000     66.64066    70.16905
------------------------------------------------------------------------------

. local suny : di %4.3f _b[rhs]

. reg truepts rhs if super==1203 [w=people]
(analytic weights assumed)
(sum of wgt is 4,311)

      Source |       SS           df       MS      Number of obs   =        20
-------------+----------------------------------   F(1, 18)        =      2.70
       Model |  11.9320042         1  11.9320042   Prob > F        =    0.1177
    Residual |  79.5390552        18   4.4188364   R-squared       =    0.1304
-------------+----------------------------------   Adj R-squared   =    0.0821
       Total |  91.4710594        19  4.81426628   Root MSE        =    2.1021

------------------------------------------------------------------------------
     truepts | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         rhs |   .0266357   .0162092     1.64   0.118    -.0074185    .0606899
       _cons |   51.57046   .8041396    64.13   0.000     49.88102    53.25989
------------------------------------------------------------------------------

. local glen : di %4.3f _b[rhs]

. 
. tw (scatter k_rank par_pctile, color(gs10) msiz(small)) (lfit k_rank par_pctile [w=count], color(gs10)) ///
>         (scatter truepts rhs if super==1312, msiz(small) color("118 145 169") ms(circle_hollow)) (lfit truepts rhs if super==1312, color("11
> 8 145 169")) ///
>         (scatter truepts rhs if super==2838, msiz(small) color("119 145 89") ms(triangle)) (lfit truepts rhs if super==2838, color("119 145 
> 89")) ///
>         (scatter truepts rhs if super==1203, msiz(small) color("233 152 51") ms(triangle_hollow)) (lfit truepts rhs if super==1203, color("2
> 33 152 51")) ///
>         , title(" ") ytitle("Child Rank") xtitle("Parent Rank") ///
>         yscale(range(30 80)) ylab(30(10)80) xscale(range(0 105)) xlab(0(20)100) ///
>         legend(order(1 3 5 7) c(1) pos(4) ring(0) region(color(none)) ///
>                 lab(1 "National (Slope: `nat')") ///
>                 lab(3 "UC Berkeley (Slope: `berk')") ///
>                 lab(5 "SUNY Stony Brook (Slope: `suny')") ///
>                 lab(7 "Glendale CC (Slope: `glen')"))
(analytic weights assumed)
(analytic weights assumed)
(analytic weights assumed)

. 
. graph export "${figs}/paper_fig_3b.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_3b.pdf saved as PDF format

. 
. 
. ************************************************************
. * Panel C: Aggregated Binscatter Points
. ************************************************************
. use ${rep_data}/paper_fig_3c , clear

. 
. 
. * Note: draw slopes from rank-rank table 
. *       (inside regressions inside regs account for within bin variation)
. tw (scatter k_rank par_pctile , color(gs10) msiz(small)) (lfit k_rank par_pctile, color(gs10) msiz(small)) ///
>         (scatter truepts  rhs if group==1, color("118 145 169") msiz(small) ms(circle_hollow)) (lfit truepts  rhs if group==1, color("118 14
> 5 169")) ///
>         (scatter truepts  rhs if group==2, color("119 145 89") msiz(small) ms(triangle)) (lfit truepts  rhs if group==2, color("119 145 89")
> ) ///
>         (scatter truepts  rhs if group==3, color("233 152 51") msiz(small) ms(triangle_hollow)) (lfit truepts  rhs if group==3, color("233 1
> 52 51")) ///
>         , title(" ") xtitle(Parent Rank) ytitle(Child Rank) ///
>         yscale(range(30 80)) ylab(30(10)80) xscale(range(0 105)) xlab(0(20)100) ///
>         legend(order(1 3 5 7) ring(0) c(1) pos(4) ///
>                 lab(1 "National (Slope: `nat')") lab(3 "Elite Colleges (Slope: 0.065)") ///
>                 lab(5 "Other Four-Year Colleges (Slope: 0.095)") lab(7 "Two-Year (Slope: 0.110)"))

.         
. graph export "$figs/paper_fig_3c.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_3c.pdf saved as PDF format

. 
. 
end of do-file

. 
. * Figure 4
. do "$fig_code/paper_fig_4.do"

. * Children’s Outcomes vs. Fraction of Low Income Students, by College
. 
. ************************************************************
. * Panel A: Top Quintile Outcomes - Ivy-Plus and Public Flagships
. ************************************************************
. use "${college_collapse}", clear
(Baseline Cross-Sectional Estimates by College)

. keep if super>0
(3 observations deleted)

. merge 1:1 super using "${covariates}", nogen keepusing(tier flagship)
(label label_iclevel already defined)
(label label_type already defined)
(label label_region already defined)
(label label_tier already defined)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           264
        from master                         0  
        from using                        264  

    Matched                             2,199  
    -----------------------------------------

. g kq5_parq1 = kq5_cond_parq1 * par_q1
(264 missing values generated)

. 
. foreach v of varlist kq5_cond_parq1 par_q1 kq5_parq1 {
  2.         replace `v'= `v'*100
  3. }
(2,184 real changes made)
(2,199 real changes made)
(2,184 real changes made)

. 
. sum kq5_parq1 [w=count], d
(analytic weights assumed)

                          kq5_parq1
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .5236037              0
 5%     .7500594              0
10%     .8798505              0       Obs               2,199
25%     1.121862              0       Sum of wgt.   2,081,387

50%     1.577994                      Mean           1.939663
                        Largest       Std. dev.      1.299257
75%     2.278686       10.23514
90%     3.470467       11.72375       Variance        1.68807
95%     4.443799       12.93859       Skewness       2.535537
99%     6.833405       16.35798       Kurtosis        13.4266

. local p10 : di %3.1f r(p10)

. local p50 : di %3.1f r(p50)

. local p90 : di %3.1f r(p90)

. local p10_line = r(p10)*100

. local p50_line = r(p50)*100

. local p90_line = r(p90)*100

. local allmean : di %3.1f r(mean)

. local allsd : di %3.2f r(sd)

. 
. sum kq5_parq1 [w=count] if tier==1
(analytic weights assumed)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
   kq5_parq1 |      12       17569    2.174399   .6473316   1.345795   3.398201

. local ivymean : di %3.1f r(mean)

. 
. sum kq5_parq1 [w=count] if flagship==1
(analytic weights assumed)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
   kq5_parq1 |      31  138731.833    1.731853   .9735594   .8706346   4.885096

. local flagmean : di %3.1f r(mean)

. 
. #delimit ;
delimiter now ;
. tw (scatter kq5_cond_parq1 par_q1 if par_q1<60, msize(vsmall) mcol(gs10)) 
>         (scatter kq5_cond_parq1 par_q1 if tier==1, color(blue) msiz(small)) 
>         (scatter kq5_cond_parq1 par_q1 if flagship==1, color(maroon) msiz(small) ms(triangle)) 
>         (function y=`p10_line'/x, range(1.8 55) color(gs7)) 
>         (function y=`p50_line'/x, range(2 55) color(gs7)) 
>         (function y=`p90_line'/x, range(3.5 55) color(gs7)) 
>         , title(" ") ytitle("Top-Quintile Outcome Rate: P(Child in Q5 | Par in Q1)") 
>         xtitle("Fraction Low-Income: Percent of Parents in Bottom Quintile")  
>         xscale(range(0 60)) xlab(0(20)60) 
>         legend(order(2 3) c(1) pos(3) ring(0) 
>                 lab(2 "Ivy Plus Colleges (Avg. MR = `ivymean'%)") 
>                 lab(3 "Public Flagships (Avg. MR = `flagmean'%)")) 
>         text(95 15 "MR = `p90'% (90th Percentile)" 
>                 82 11 "MR = `p50'% (50th Percentile)" 
>                 0 11 "MR = `p10'% (10th Percentile)" 
>                 70 39 "MR = Top-Quintile Outcome Rate x Fraction Low-Income" 
>                 65 55 "SD of MR = `allsd'%")
>         ;

. #delimit cr
delimiter now cr
. graph export "${figs}/paper_fig_4a.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_4a.pdf saved as PDF format

. 
. 
. ************************************************************
. * Panel B: Top Percentile Outcomes - Ivy-Plus and Public Flagships
. ************************************************************
. use "${college_collapse}", clear
(Baseline Cross-Sectional Estimates by College)

. keep if super>0
(3 observations deleted)

. merge 1:1 super using "${covariates}", nogen keepusing(tier flagship)
(label label_iclevel already defined)
(label label_type already defined)
(label label_region already defined)
(label label_tier already defined)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           264
        from master                         0  
        from using                        264  

    Matched                             2,199  
    -----------------------------------------

. g ktop1_parq1 = ktop1pc_cond_parq1 * par_q1
(264 missing values generated)

. 
. foreach v of varlist ktop1pc_cond_parq1 par_q1 ktop1_parq1 {
  2.         replace `v'= `v'*100
  3. }
(1,731 real changes made)
(2,199 real changes made)
(1,731 real changes made)

. 
. sum ktop1_parq1 [w=count], d
(analytic weights assumed)

                         ktop1_parq1
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               2,199
25%     .0069516              0       Sum of wgt.   2,081,387

50%     .0332106                      Mean           .0625877
                        Largest       Std. dev.        .09547
75%     .0730509       .7786875
90%      .154257       .7985172       Variance       .0091145
95%     .2116537       .9638512       Skewness       3.745409
99%     .5072356       1.249444       Kurtosis        22.7184

. local p10 : di %3.2f r(p10)

. local p50 : di %3.2f r(p50)

. local p90 : di %3.2f r(p90)

. local p10_line = r(p10)*100

. local p50_line = r(p50)*100

. local p90_line = r(p90)*100

. local allmean : di %3.1f r(mean)

. local allsd : di %3.2f r(sd)

. 
. sum ktop1_parq1 [w=count] if tier==1
(analytic weights assumed)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
 ktop1_parq1 |      12       17569     .479529   .1490645   .2026412   .7503281

. local ivymean : di %3.1f r(mean)

. 
. sum ktop1_parq1 [w=count] if flagship==1
(analytic weights assumed)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
 ktop1_parq1 |      31  138731.833    .1146315   .1390224          0   .7639818

. local flagmean : di %3.1f r(mean)

. 
. di in red `p10'
0

. di in red `p50'
.03

. di in red `p90'
.15

. #delimit ;
delimiter now ;
. tw (scatter ktop1pc_cond_parq1 par_q1 if par_q1<60 & ktop1pc_cond_parq1<20, msize(vsmall) mcol(gs10)) 
>         (scatter ktop1pc_cond_parq1 par_q1 if tier==1, color(blue) msize(small)) 
>         (scatter ktop1pc_cond_parq1 par_q1 if flagship==1, color(maroon) msize(small) ms(triangle)) 
>         (function y=`p10_line'/x, range(1.3 55) color(gs7)) 
>         (function y=`p50_line'/x, range(1 55) color(gs7)) 
>         (function y=`p90_line'/x, range(1 55) color(gs7)) 
>         , title(" ") ytitle("Top-Percentile Outcome Rate: P(Child in Top1 | Par in Q1)") 
>         xtitle("Fraction Low-Income: Percent of Parents in Bottom Quintile") 
>         xscale(range(0 60)) xlab(0(10)60) 
>         legend(order(2 3) c(1) pos(3) ring(0) 
>                 lab(2 "Ivy-Plus Colleges (Avg. UMR = `ivymean'%)") 
>                 lab(3 "Public Flagships (Avg. UMR = `flagmean'%)")) 
>         text(16 13 "UMR = `p90'% (90th Percentile)" 
>                 1 50 "UMR = `p50'% (50th Percentile)" 
>                 14 33 "Upper-Tail MR = Top-Percentile Outcome Rate x Fraction Low-Income" 
>                 13 51 "SD of UMR = `allsd'%")
>         ;

. #delimit cr
delimiter now cr
. graph export "${figs}/paper_fig_4b.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_4b.pdf saved as PDF format

. 
end of do-file

. 
. * Figure 5
. // constructed directly from the individual-level microdata
. do "$fig_code/paper_fig_5.do"

. * Ivy-Plus Attendance Rates and SAT Scores by Parental Income
. 
. ************************************************************
. * Panel A: High-SAT Scorers vs. Ivy-Plus Colleges
. ************************************************************
. 
. use ${rep_data}/paper_fig_5a  , clear

. 
. gen parq1 = parq - 0.2 if series == 1 // "Nationwide 1300+ SAT-scorers"
(5 missing values generated)

. gen parq2 = parq + 0.2 if series == 2 // "Ivy-Plus enrollees"
(5 missing values generated)

. 
. #delimit ;
delimiter now ;
. twoway (bar q parq1, barw(0.4) color(cranberry*.8))
>                 (bar q parq2, barw(0.4) color("0 32 96"))
>         , ylabel( , nogrid) 
>         xlabel(1(1)5)
>         legend(col(1) pos(6) ring(6) order(1 "Nationwide 1300+ SAT-scorers" 2 "Ivy-Plus actual")) 
>         ytitle("Share of Students (%)") 
>         xtitle("Parent Income Quintile")
>         ylabel(0(10)70)
>         graphregion(margin(t+2))
>         ;

. # delimit cr
delimiter now cr
. 
. graph export "${figs}/paper_fig_5a.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_5a.pdf saved as PDF format

. 
. 
. ************************************************************
. * Panel B: Ivy-Plus Attendance Rates for Students with an SAT/ACT Score of 1400
. ************************************************************
. 
. use ${rep_data}/paper_fig_5b  , clear

.         
. * Switches
. local par_bin pctile

. 
. * Calculate average
. foreach series in 1400 {
  2.                 sum ivy_rate_`series' [aw = cnt_`series' ] , d
  3.                 local yline_`series' = `r(mean)'
  4. }

                        ivy_rate_1400
-------------------------------------------------------------
      Percentiles      Smallest
 1%     2.554745       2.185792
 5%     3.061224       2.554745
10%     3.974895       2.564103       Obs                 100
25%      4.33145       2.583026       Sum of wgt.      43,653

50%     5.701079                      Mean           7.930726
                        Largest       Std. dev.      5.674489
75%     9.500805       13.97849
90%     15.38462       15.38462       Variance       32.19983
95%     18.02175       18.02175       Skewness       1.895255
99%     26.23716       26.23716       Kurtosis       6.130338

. 
. ** x axis
. local pctile_xcale "0 99"

. local pctile_xlabel " "

. 
. ** y axis
. local att_ivy_plus_ytitle   "Probability of Attending an Ivy Plus (%)"

. local yscale "`r(min)'(5)`r(max)'"

. 
. 
. ** Only 1400 scorers
. #delimit ;
delimiter now ;
. twoway (lowess ivy_rate_1400 par_agi_pctile , lc(navy) bwidth(.2))
>         (scatter ivy_rate_1400 par_agi_pctile, mc(navy)                                           
>         title(" ")                                                                                        
>         ytitle("Share attending an Ivy-Plus college")                                                     
>         xtitle("Parent Income Percentile")                                                        
>         ysc(r(5(5)25))
>         xsc(r(``par_bin'_xscale'))                                        
>         xlabel(``par_bin'_xlabel')                                    
>         graphregion(color("white")) bgcolor(white)                        
>         legend( off )                                                                                 
>         yline(`yline_1400', lp(dash) lc(black))
>         )
>         ;

. #delimit cr
delimiter now cr
. 
. graph export "${figs}/paper_fig_5b.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_5b.pdf saved as PDF format

. 
end of do-file

. 
. * Figure 6
. // constructed directly from the individual-level microdata
. do "$fig_code/paper_fig_6.do"

. * Impacts of Counterfactuals on Income Segregation and Intergenerational Mobility
. 
. ************************************************************
. * Panel A: Fraction of Peers from Top-Quintile 
. ************************************************************
. 
. use ${rep_data}/paper_fig_6a  , clear

. 
. #delimit;
delimiter now ;
. tw  (bar share_of_peers_q5_1 x1, barwidth(0.3) color("0 32 96"))
>         (bar share_of_peers_q5_2 x2, barwidth(0.3) color("84 130 53"))
>         (bar share_of_peers_q5_3 x3, barwidth(0.3) color("169 209 142"))
>         (function y = 30.8, range(.75 3.75) color(black) lpattern(dash)),
>         ylabel(0(10)40, nogrid)
>         ytitle("Share of College Peers with Top-Quintile" "Parents (%)")
>         xlabel(1.5 "Children from Bottom Quintile" 3 "Children from Top Quintile")
>         legend(on order(1 "Actual" 
>                                         2 "Income-Neutral Student Allocations counterfactual (0-point SAT increment)" 
>                                         3 "Need-Affirmative Student Allocations counterfactual (${cbaa_adj}-point SAT increment)") 
>                 row(3)  size(small) )
>         text(32 1.32 "Random allocation benchmark", size(medsmall))
> ;

. #delimit cr
delimiter now cr
. 
. graph export "${figs}/paper_fig_6a.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_6a.pdf saved as PDF format

. 
. ************************************************************
. * Panel B: Fraction of Students with Low-Income Parents
. ************************************************************
. 
. use ${rep_data}/paper_fig_6b  , clear

. 
. #delimit ;
delimiter now ;
. tw (bar share_parq_tier_act x1, barwidth(0.5) color("0 32 96")) 
>         (bar share_parq_tier_sat x2, barwidth(0.5) color("84 130 53")) 
>         (bar share_parq_tier_bump x3, barwidth(0.5) color("169 209 142")) 
>         , ylabel(0(5)15, nogrid) 
>         xlabel(3 "Ivy Plus" 6 "Selective Tiers" 9 "Unselective Tiers") 
>         legend(col(1) pos(7) ring(6) order(1 "Actual" 
>                                                                                 2 "Income-Neutral Student Allocations counterfactual (0-poin
> t SAT increment)" 
>                                                                                 3 "Need-Affirmative Student Allocations counterfactual (${cb
> aa_adj}-point SAT increment)") 
>                         size(small) ) 
>         ytitle("Share of Students with Bottom-Quintile" "Parents (%)") 
>         graphregion(margin(t+2))
>         ;

. #delimit cr
delimiter now cr
. 
. graph export "${figs}/paper_fig_6b.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_6b.pdf saved as PDF format

.         
. 
. ************************************************************
. * Panel C: Counterfactual Gaps in Chance of Reaching Top Earnings Quintile
. ************************************************************
. 
. use ${rep_data}/paper_fig_6c  , clear

. 
. * save difference betweeen actual and counterfactuals
. summ gap if bump == -1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         gap |          1    22.01865           .   22.01865   22.01865

. local gap_actual = `r(mean)'

. summ gap if bump == 0 

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         gap |          1    18.79805           .   18.79805   18.79805

. local gap_0 = `r(mean)'

. local diff_gap_actual_0 : ///
>                                         di %4.1f (`gap_actual' - `gap_0') / `gap_actual' * 100

. summ gap if bump == ${cbaa_adj}

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         gap |          1    16.17987           .   16.17987   16.17987

. local gap_${cbaa_adj} = `r(mean)'

. local diff_gap_actual_${cbaa_adj} : ///
>                                         di %4.1f (`gap_actual' - `gap_${cbaa_adj}') / `gap_actual' * 100

.                                         
. * bar graph 
. #delimit ;
delimiter now ;
. twoway 
>         (bar gap xaxis if xaxis == 1, barw(0.5) color("0 32 96")) 
>         (bar gap xaxis if xaxis == 2, barw(0.5) color("84 130 53")) 
>         (bar gap xaxis if xaxis == 3, barw(0.5) color("169 209 142")) 
>         , 
>                 plotregion(margin(r=15)) 
>                 legend(off) 
>         ylabel(10(2)22, nogrid) 
>         xlabel(1 "Actual" 
>                    2 `" "Income-Neutral" "Student Allocations" "counterfactual" "(0-point SAT increment)" "' 
>                    3 `" "Need-Affirmative" "Student Allocations" "counterfactual" "(${cbaa_adj}-point SAT increment)" "') 
>         xtitle("") 
>         ytitle("Rich-Poor Gap in Top Quintile Outcome Rate" "among College-Goers (pp)") 
>         text(21.05 1.78  "`=ustrunescape("\u23AB")'" "`=ustrunescape("\u23AC")'"  "`=ustrunescape("\u23AD")'" , size(*1.38) color(black)) 
>         text(21.5 1.8 "`diff_gap_actual_0'% reduction", place(e)) 
>         text(20.8 1.82 "in gap", place(e)) 
>         text(19.4 2.82  "`=ustrunescape("\u23AB")'" "`=ustrunescape("\u23AC")'"  "`=ustrunescape("\u23AD")'" , size(*3.68) color(black)) 
>         text(19.8  2.86 "`diff_gap_actual_${cbaa_adj}'% reduction", place(e)) 
>         text(19.1 2.88 "in gap", place(e)) 
> ;

. #delimit cr
delimiter now cr
. 
. graph export "${figs}/paper_fig_6c.${image_suffix}", replace
file /Users/tylersotomayor/dataverse_files/exhibit_replication/output/figures/paper_fig_6c.pdf saved as PDF format

. 
end of do-file

. 
. 
. ********************************************************************************
. * Main Tables
. ********************************************************************************
. * Table 1
. do "$tab_code/paper_tab_1.do"

. estimates clear

. 
. * Summary Stats for Main College Collapse. Median Earnings stats for
. * parent and kid earnings should come from inside the IRS environment. 
. * Non-college goer columns use the true data from the tiers, college goer
. * columns use the publically released data.
. 
. ********************************************************************************
. * Using the tier data, loop over two subsets: all children and non-college goers.
. use "${tier_paragi_pooled}", clear
(Cross-Sectional Statistics by College Tier and Parent Income Percentile )

. 
. drop if par_pctile == 99.9
(15 observations deleted)

. 
. * First subset to get total coll goers
. foreach subset in 1 tier>13 {
  2. 
.         di ""
  3.         di ""
  4.         di "TABLE FOR `subset'"
  5.         di ""
  6.         di ""
  7. 
.         preserve
  8.         keep if `subset'
  9. 
.         * Count people.
.         egen total_count = total(count)
 10. 
.         * Count people attending different classifications of colleges.
.         egen attending_college                  = total(count * inrange(tier,1,13))
 11.         egen attending_college_insample = total(count * inrange(tier,1,12))
 12.         egen attending_ivy                              = total(count * (tier == 1))
 13.         egen attending_other_elite              = total(count * (tier == 2))
 14.         egen attending_other_four_year  = total(count * inlist(tier,3,4,5,6,7,8,10))
 15.         egen attending_two_year_less    = total(count * inlist(tier,9,11,12))
 16.         egen never_attending            = total(count * (tier == 14.2))
 17. 
.         * Calculate proportions attending different classifications of colleges.
.         gen prop_attending_college          = attending_college          / total_count
 18.         gen prop_attending_college_insample = attending_college_insample / total_count
 19.         gen prop_attending_ivy              = attending_ivy              / total_count
 20.         gen prop_attending_other_elite      = attending_other_elite      / total_count
 21.         gen prop_attending_other_four_year  = attending_other_four_year  / total_count
 22.         gen prop_attending_two_year_less    = attending_two_year_less    / total_count
 23.         gen prop_never_attending            = never_attending            / total_count
 24. 
.         * Calculate parent/kid earning conditionals and joints.
.         egen par_q1                     = total(count*(par_pctile<20))
 25.         egen par_q1_kid_q5  = total(count*(par_pctile<20)*k_q5)
 26.         egen par_q1_kid_p99 = total(count*(par_pctile<20)*k_top1pc)
 27.         generate kq5_cond_parq1_mean  = par_q1_kid_q5  / par_q1
 28.         generate kp99_cond_parq1_mean = par_q1_kid_p99 / par_q1
 29.         generate kq5_joint_parq1  = par_q1_kid_q5  / total_count 
 30.         generate kp99_joint_parq1 = par_q1_kid_p99 / total_count
 31. 
.         * Calculate employment rate, parent/kid mean income/earnings, and positional
.         * statistics.
.         egen employment                 = wtmean(1-k_nowork),      weight(count)
 32.         egen par_mean_overall   = wtmean(par_mean),        weight(count) 
 33.         egen par_q1_overall             = wtmean(par_pctile<20),   weight(count) 
 34.         egen par_q5_overall             = wtmean(par_pctile>79),   weight(count) 
 35.         egen par_top1pc_overall = wtmean(par_pctile==99),  weight(count)
 36.         egen k_mean_overall     = wtmean(k_mean),          weight(count)   
 37.         egen k_q5_overall       = wtmean(k_q5),            weight(count)   
 38.         egen k_top1pc_overall   = wtmean(k_top1pc),        weight(count)   
 39.                    
.         * Count proportion of sample included.
.         if "`subset'" == "1" local total_attending_college = attending_college[1]
 40.         gen prop_covered = total_count / `total_attending_college'
 41.         
.         if "`subset'" == "tier>13" replace prop_attending_college = .
 42.         if "`subset'" == "tier>13" replace prop_attending_college_insample = .
 43.         
. 
.         * Present statistics in a table.
.         eststo: estpost summarize ///
>                         prop_attending_college ///
>                         prop_attending_college_insample ///
>                         prop_never_attending ///
>                         par_mean_overall ///
>                         k_mean_overall ///
>                         employment ///
>                         total_count, ///
>                         meanonly
 44.                         
.         restore
 45. }


TABLE FOR 1


(0 observations deleted)
unknown egen function wtmean()
r(133);

end of do-file
r(133);

end of do-file

r(133);

. do "/Users/tylersotomayor/dataverse_files/exhibit_replication/code/header.do"

. 
. *************************************
. * Metafile - College Paper
. *************************************
. set more off

. set matsize 800
set matsize ignored.
    Matrix sizes are no longer limited by c(matsize) in modern Statas.  Matrix sizes are now limited by edition of Stata.  See limits for
    more details.

. 
. 
. global root "${replication_folder}"  

. 
. 
. *************
. * Code
. *************
. global code ${root}/code

. global fig_code ${code}/figures

. global tab_code ${code}/tables

. 
. *************
. * Output
. *************
. * Figures output directory
. global output ${root}/output

. global figs ${output}/figures

. global tabs ${output}/tables

. 
. *************
. * Input
. *************
. global input ${root}/input

. 
. * Published online datatables
. global data ${input}/online_tables

. * Figure replication input
. global rep_data ${input}/replication

. 
. 
. * College collapse
. global college_collapse "${data}/mrc_table2.dta" 

. 
. * College collapse by tax year
. global college_taxyr "${data}/mrc_table3.dta" 

. 
. * College collapse robustness checks
. global robustness "${data}/mrc_table4.dta"

. 
. * Table 5: Robustness by Cohort
. global robustness_cohort "${data}/mrc_table5.dta"

. 
. * Tier-Paragi - pooled
. global tier_paragi_pooled "${data}/mrc_table6.dta"

. 
. * Tier kid-wagse 
. global tier_kid_pooled "${data}/mrc_table7.dta"

. 
. * Paragi tier by cohort - quintile
. global tier_paragi_cohort "${data}/mrc_table8.dta"

. 
. * Cutoffs
. global cutoffs "${data}/mrc_table9.dta"

. 
. * College Covariates 
. global covariates "${data}/mrc_table10.dta"

. 
. * OPEID - Super-OPEID crosswalk
. global cross "${data}/mrc_table11.dta"

. 
. * Normed Parent Income and Mobility Rate Estimates
. global normed "${data}/mrc_table14.dta"

. 
. * Close Super-OPEIDs
. global closed_supers "${data}/mrc_table15.dta"

. 
. 
. 
. * Counterfactuals
. global cbaa_adj 160

. 
end of do-file

. do "/Users/tylersotomayor/dataverse_files/exhibit_replication/code/header.do"

. 
. *************************************
. * Metafile - College Paper
. *************************************
. set more off

. set matsize 800
set matsize ignored.
    Matrix sizes are no longer limited by c(matsize) in modern Statas.  Matrix sizes are now limited by edition of Stata.  See limits for
    more details.

. 
. 
. global root "${replication_folder}"  

. 
. 
. *************
. * Code
. *************
. global code ${root}/code

. global fig_code ${code}/figures

. global tab_code ${code}/tables

. 
. *************
. * Output
. *************
. * Figures output directory
. global output ${root}/output

. global figs ${output}/figures

. global tabs ${output}/tables

. 
. *************
. * Input
. *************
. global input ${root}/input

. 
. * Published online datatables
. global data ${input}/online_tables

. * Figure replication input
. global rep_data ${input}/replication

. 
. 
. * College collapse
. global college_collapse "${data}/mrc_table2.dta" 

. 
. * College collapse by tax year
. global college_taxyr "${data}/mrc_table3.dta" 

. 
. * College collapse robustness checks
. global robustness "${data}/mrc_table4.dta"

. 
. * Table 5: Robustness by Cohort
. global robustness_cohort "${data}/mrc_table5.dta"

. 
. * Tier-Paragi - pooled
. global tier_paragi_pooled "${data}/mrc_table6.dta"

. 
. * Tier kid-wagse 
. global tier_kid_pooled "${data}/mrc_table7.dta"

. 
. * Paragi tier by cohort - quintile
. global tier_paragi_cohort "${data}/mrc_table8.dta"

. 
. * Cutoffs
. global cutoffs "${data}/mrc_table9.dta"

. 
. * College Covariates 
. global covariates "${data}/mrc_table10.dta"

. 
. * OPEID - Super-OPEID crosswalk
. global cross "${data}/mrc_table11.dta"

. 
. * Normed Parent Income and Mobility Rate Estimates
. global normed "${data}/mrc_table14.dta"

. 
. * Close Super-OPEIDs
. global closed_supers "${data}/mrc_table15.dta"

. 
. 
. 
. * Counterfactuals
. global cbaa_adj 160

. 
end of do-file

. do "/Users/tylersotomayor/dataverse_files/FINAL_DO.do"

. ********************************************************************************
. *  Event Study: Tennessee HOPE Scholarship
. *  Replicates all 6 figures from the Python analysis
. *
. *  Requires: reghdfe, coefplot (ssc install reghdfe / ssc install coefplot)
. ********************************************************************************
. 
. clear all

. set more off

. 
. * ── Install required packages if missing ──
. capture which reghdfe

. if _rc {
.     ssc install require, replace
.     ssc install ftools, replace
.     ssc install reghdfe, replace
.     ssc install ivreg2, replace
.     ssc install ranktest, replace
. }

. capture which coefplot

. if _rc {
.     ssc install coefplot, replace
. }

. 
. * ── Load data ──
. capture confirm file "mrc_table3.csv"

. if _rc {
.     di as error "ERROR: mrc_table3.csv not found in current directory."
.     di as error "Please cd to the folder containing the file, e.g.:"
.     di as error `"    cd "/Users/tommysoltanian/Desktop/Metrics Competition""'
.     exit 601
. }

. import delimited "mrc_table3.csv", clear
(encoding automatically selected: ISO-8859-1)
(84 vars, 29,580 obs)

. 
. * ── State FIPS from county FIPS ──
. tostring cfips, gen(cfips_str) format(%05.0f)
cfips_str generated as str5

. gen sfips = real(substr(cfips_str, 1, 2))
(24 missing values generated)

. 
. * ── Rename for clarity ──
. rename type collegetype

. rename cohort year

. 
. * ── Treatment definition ──
. gen treated = (state == "TN" & collegetype == 1)

. gen rel_time = year - (2004 - 19)

. gen post = (year >= 2004 - 19)

. gen treat_post = treated * post

. 
. * ── Event study dummies with endpoint binning ──
. forv i = -5/-1 {
  2.     local j = abs(`i')
  3.     gen h_cm`j' = cond(treated == 1 & rel_time == `i', 1, 0)
  4. }

. forv i = 0/6 {
  2.     gen h_c`i' = cond(treated == 1 & rel_time == `i', 1, 0)
  3. }

. gen h_cm6 = cond(treated == 1 & rel_time < -5, 1, 0)

. replace h_c6 = cond(treated == 1 & rel_time > 5, 1, h_c6)
(0 real changes made)

. 
. * Macro for event study variables (drop h_cm1 as reference)
. local esvars "h_cm6 h_cm5 h_cm4 h_cm3 h_cm2 h_c0 h_c1 h_c2 h_c3 h_c4 h_c5 h_c6"

. local eskeep "h_cm5 h_cm4 h_cm3 h_cm2 h_c0 h_c1 h_c2 h_c3 h_c4 h_c5"

. local esrename `"h_cm5="-5" h_cm4="-4" h_cm3="-3" h_cm2="-2" h_c0="0" h_c1="1" h_c2="2" h_c3="3" h_c4="4" h_c5="5""'

. local esorder "h_cm5 h_cm4 h_cm3 h_cm2 h_c0 h_c1 h_c2 h_c3 h_c4 h_c5"

. 
. * Save full dataset
. tempfile fulldata

. save `fulldata'
file /var/folders/bk/6srdc2qx62b56c7594wqt1yw0000gn/T//S_14844.000001 saved as .dta format

. 
. 
. ********************************************************************************
. *  SPECIFICATION 1: Baseline
. *  Treated = TN Public | Control = All Others (excl. merit aid states)
. ********************************************************************************
. 
. use `fulldata', clear

. drop if inlist(state, "GA", "FL", "WV", "NV", "WY", "WI")
(3,192 observations deleted)

. 
. * ── Figure 1: par_q1 ──
. reghdfe par_q1 `esvars', a(super_opeid year) vce(cl sfips)
(dropped 7 singleton observations)
(MWFE estimator converged in 5 iterations)
note: h_cm6 omitted because of collinearity

HDFE Linear regression                            Number of obs   =     23,395
Absorbing 2 HDFE groups                           F(  11,     44) =     100.60
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.9485
                                                  Adj R-squared   =     0.9431
                                                  Within R-sq.    =     0.0030
Number of clusters (sfips)   =         45         Root MSE        =     0.0214

                                 (Std. err. adjusted for 45 clusters in sfips)
------------------------------------------------------------------------------
             |               Robust
      par_q1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       h_cm6 |          0  (omitted)
       h_cm5 |   .0022459   .0013183     1.70   0.096    -.0004109    .0049026
       h_cm4 |  -.0057946    .001109    -5.22   0.000    -.0080297   -.0035594
       h_cm3 |   .0017402   .0006003     2.90   0.006     .0005303    .0029501
       h_cm2 |   .0012664   .0006293     2.01   0.050    -1.84e-06    .0025345
        h_c0 |   .0039423   .0006687     5.90   0.000     .0025947      .00529
        h_c1 |    .007374   .0008038     9.17   0.000      .005754    .0089939
        h_c2 |   .0121994   .0012064    10.11   0.000      .009768    .0146307
        h_c3 |   .0145071   .0014511    10.00   0.000     .0115827    .0174315
        h_c4 |   .0119371   .0020275     5.89   0.000      .007851    .0160233
        h_c5 |   .0206215     .00221     9.33   0.000     .0161676    .0250754
        h_c6 |    .033412   .0026233    12.74   0.000     .0281251    .0386989
       _cons |   .1254846   .0000112  1.1e+04   0.000      .125462    .1255072
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
 super_opeid |      2190        2190           0    *|
        year |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. 
. coefplot, keep(`eskeep') vertical ///
>     rename(`esrename') order(`esorder') ///
>     yline(0, lcolor(gs12) lwidth(thin)) ///
>     xline(4.5, lpattern(dash) lcolor(gs10) lwidth(thin)) ///
>     title("Treatment Effect on Bottom Quintile Share", size(medium)) ///
>     subtitle("Tennessee HOPE Scholarship — Clustered by State", size(small)) ///
>     ytitle("Average causal effect") xtitle("Periods since treatment") ///
>     mcolor(navy) msymbol(circle) msize(small) ///
>     ciopts(lcolor(navy%50) lwidth(medthin)) ///
>     graphregion(color(white)) bgcolor(white) ///
>     ylabel(, angle(horizontal) format(%9.3f))

. 
. graph export "baseline_par_q1.pdf", replace
file /Users/tylersotomayor/dataverse_files/baseline_par_q1.pdf saved as PDF format

. graph drop _all

. 
. * ── Figure 2: par_rank ──
. reghdfe par_rank `esvars', a(super_opeid year) vce(cl sfips)
(dropped 7 singleton observations)
(MWFE estimator converged in 5 iterations)
note: h_cm6 omitted because of collinearity

HDFE Linear regression                            Number of obs   =     23,395
Absorbing 2 HDFE groups                           F(  11,     44) =      92.20
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.9760
                                                  Adj R-squared   =     0.9735
                                                  Within R-sq.    =     0.0045
Number of clusters (sfips)   =         45         Root MSE        =     0.0205

                                 (Std. err. adjusted for 45 clusters in sfips)
------------------------------------------------------------------------------
             |               Robust
    par_rank | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       h_cm6 |          0  (omitted)
       h_cm5 |   .0055763   .0014791     3.77   0.000     .0025954    .0085573
       h_cm4 |   .0097788   .0012861     7.60   0.000     .0071869    .0123707
       h_cm3 |   .0011498   .0006133     1.87   0.067    -.0000863    .0023859
       h_cm2 |   .0021427   .0005614     3.82   0.000     .0010114    .0032741
        h_c0 |  -.0049317   .0005524    -8.93   0.000    -.0060449   -.0038184
        h_c1 |  -.0117991   .0007863   -15.01   0.000    -.0133838   -.0102144
        h_c2 |  -.0109245   .0010791   -10.12   0.000    -.0130993   -.0087497
        h_c3 |  -.0148152   .0014024   -10.56   0.000    -.0176414   -.0119889
        h_c4 |  -.0171953   .0019773    -8.70   0.000    -.0211802   -.0132103
        h_c5 |  -.0235453   .0021523   -10.94   0.000     -.027883   -.0192076
        h_c6 |  -.0326319    .002405   -13.57   0.000    -.0374789   -.0277849
       _cons |   .5743796   .0000105  5.4e+04   0.000     .5743583    .5744008
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
 super_opeid |      2190        2190           0    *|
        year |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. 
. coefplot, keep(`eskeep') vertical ///
>     rename(`esrename') order(`esorder') ///
>     yline(0, lcolor(gs12) lwidth(thin)) ///
>     xline(4.5, lpattern(dash) lcolor(gs10) lwidth(thin)) ///
>     title("Treatment Effect on Mean Parent Income Rank", size(medium)) ///
>     subtitle("Tennessee HOPE Scholarship — Clustered by State", size(small)) ///
>     ytitle("Average causal effect") xtitle("Periods since treatment") ///
>     mcolor(navy) msymbol(circle) msize(small) ///
>     ciopts(lcolor(navy%50) lwidth(medthin)) ///
>     graphregion(color(white)) bgcolor(white) ///
>     ylabel(, angle(horizontal) format(%9.3f))

. 
. graph export "baseline_par_rank.pdf", replace
file /Users/tylersotomayor/dataverse_files/baseline_par_rank.pdf saved as PDF format

. graph drop _all

. 
. 
. ********************************************************************************
. *  SPECIFICATION 2: Public vs Private — Independent Regressions
. *  All states, no drops
. ********************************************************************************
. 
. * ── Public subsample ──
. use `fulldata', clear

. keep if collegetype == 1
(14,436 observations deleted)

. 
. gen treated_sub = (state == "TN")

. gen rel_sub = year - (2004 - 19)

. 
. forv i = -5/-1 {
  2.     local j = abs(`i')
  3.     gen hs_cm`j' = cond(treated_sub == 1 & rel_sub == `i', 1, 0)
  4. }

. forv i = 0/6 {
  2.     gen hs_c`i' = cond(treated_sub == 1 & rel_sub == `i', 1, 0)
  3. }

. gen hs_cm6 = cond(treated_sub == 1 & rel_sub < -5, 1, 0)

. replace hs_c6 = cond(treated_sub == 1 & rel_sub > 5, 1, hs_c6)
(0 real changes made)

. 
. local esvars_s "hs_cm6 hs_cm5 hs_cm4 hs_cm3 hs_cm2 hs_c0 hs_c1 hs_c2 hs_c3 hs_c4 hs_c5 hs_c6"

. 
. reghdfe par_q1 `esvars_s', a(super_opeid year) vce(cl sfips)
(dropped 2 singleton observations)
(MWFE estimator converged in 5 iterations)
note: hs_cm6 omitted because of collinearity

HDFE Linear regression                            Number of obs   =     14,004
Absorbing 2 HDFE groups                           F(  11,     50) =     129.13
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.9425
                                                  Adj R-squared   =     0.9367
                                                  Within R-sq.    =     0.0060
Number of clusters (sfips)   =         51         Root MSE        =     0.0201

                                 (Std. err. adjusted for 51 clusters in sfips)
------------------------------------------------------------------------------
             |               Robust
      par_q1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      hs_cm6 |          0  (omitted)
      hs_cm5 |   .0042577   .0015817     2.69   0.010     .0010807    .0074347
      hs_cm4 |  -.0046972   .0013313    -3.53   0.001    -.0073712   -.0020232
      hs_cm3 |   .0016368   .0008942     1.83   0.073    -.0001592    .0034328
      hs_cm2 |   .0017597   .0007612     2.31   0.025     .0002308    .0032887
       hs_c0 |   .0057461   .0010147     5.66   0.000     .0037081    .0077841
       hs_c1 |   .0079824   .0012393     6.44   0.000     .0054932    .0104716
       hs_c2 |   .0143697   .0015183     9.46   0.000     .0113201    .0174193
       hs_c3 |   .0161666   .0018887     8.56   0.000     .0123731    .0199601
       hs_c4 |   .0141662   .0023999     5.90   0.000     .0093459    .0189865
       hs_c5 |   .0224276   .0026447     8.48   0.000     .0171154    .0277397
       hs_c6 |   .0344639   .0029275    11.77   0.000     .0285838     .040344
       _cons |    .143526   .0000227  6312.97   0.000     .1434803    .1435717
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
 super_opeid |      1260        1260           0    *|
        year |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store pub_q1

. 
. reghdfe par_rank `esvars_s', a(super_opeid year) vce(cl sfips)
(dropped 2 singleton observations)
(MWFE estimator converged in 5 iterations)
note: hs_cm6 omitted because of collinearity

HDFE Linear regression                            Number of obs   =     14,004
Absorbing 2 HDFE groups                           F(  11,     50) =     108.91
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.9733
                                                  Adj R-squared   =     0.9706
                                                  Within R-sq.    =     0.0082
Number of clusters (sfips)   =         51         Root MSE        =     0.0175

                                 (Std. err. adjusted for 51 clusters in sfips)
------------------------------------------------------------------------------
             |               Robust
    par_rank | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      hs_cm6 |          0  (omitted)
      hs_cm5 |   .0011618   .0015509     0.75   0.457    -.0019533    .0042768
      hs_cm4 |   .0075753   .0013932     5.44   0.000      .004777    .0103736
      hs_cm3 |   .0008092   .0009035     0.90   0.375    -.0010055    .0026239
      hs_cm2 |   .0021388   .0004042     5.29   0.000      .001327    .0029507
       hs_c0 |  -.0051135   .0006989    -7.32   0.000    -.0065172   -.0037098
       hs_c1 |  -.0114282   .0010618   -10.76   0.000    -.0135608   -.0092956
       hs_c2 |   -.010083   .0014288    -7.06   0.000    -.0129529   -.0072131
       hs_c3 |  -.0136932   .0019402    -7.06   0.000    -.0175902   -.0097963
       hs_c4 |  -.0158442   .0024409    -6.49   0.000    -.0207469   -.0109415
       hs_c5 |  -.0221602   .0026769    -8.28   0.000    -.0275369   -.0167835
       hs_c6 |  -.0308619   .0029103   -10.60   0.000    -.0367073   -.0250164
       _cons |   .5382114   .0000224  2.4e+04   0.000     .5381664    .5382565
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
 super_opeid |      1260        1260           0    *|
        year |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store pub_rank

. 
. * ── Private subsample ──
. use `fulldata', clear

. keep if collegetype == 2 | collegetype == 3
(15,168 observations deleted)

. 
. gen treated_sub = (state == "TN")

. gen rel_sub = year - (2004 - 19)

. 
. forv i = -5/-1 {
  2.     local j = abs(`i')
  3.     gen hs_cm`j' = cond(treated_sub == 1 & rel_sub == `i', 1, 0)
  4. }

. forv i = 0/6 {
  2.     gen hs_c`i' = cond(treated_sub == 1 & rel_sub == `i', 1, 0)
  3. }

. gen hs_cm6 = cond(treated_sub == 1 & rel_sub < -5, 1, 0)

. replace hs_c6 = cond(treated_sub == 1 & rel_sub > 5, 1, hs_c6)
(0 real changes made)

. 
. reghdfe par_q1 `esvars_s', a(super_opeid year) vce(cl sfips)
(dropped 7 singleton observations)
(MWFE estimator converged in 5 iterations)
note: hs_cm6 omitted because of collinearity

HDFE Linear regression                            Number of obs   =     12,084
Absorbing 2 HDFE groups                           F(  11,     49) =      61.16
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.9488
                                                  Adj R-squared   =     0.9431
                                                  Within R-sq.    =     0.0009
Number of clusters (sfips)   =         50         Root MSE        =     0.0234

                                 (Std. err. adjusted for 50 clusters in sfips)
------------------------------------------------------------------------------
             |               Robust
      par_q1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      hs_cm6 |          0  (omitted)
      hs_cm5 |   .0025945   .0012676     2.05   0.046     .0000472    .0051418
      hs_cm4 |  -.0100817   .0012501    -8.06   0.000    -.0125938   -.0075695
      hs_cm3 |   -.008791   .0009256    -9.50   0.000    -.0106511   -.0069308
      hs_cm2 |  -.0024378   .0009353    -2.61   0.012    -.0043174   -.0005583
       hs_c0 |  -.0077769    .000848    -9.17   0.000    -.0094809   -.0060728
       hs_c1 |    .001992   .0008114     2.45   0.018     .0003613    .0036226
       hs_c2 |  -.0073015   .0012783    -5.71   0.000    -.0098703   -.0047327
       hs_c3 |  -.0003492   .0012495    -0.28   0.781    -.0028601    .0021617
       hs_c4 |  -.0072653   .0016607    -4.37   0.000    -.0106027   -.0039279
       hs_c5 |   .0020235    .001812     1.12   0.270    -.0016178    .0056648
       hs_c6 |  -.0018849   .0022352    -0.84   0.403    -.0063768    .0026069
       _cons |   .1094814   .0000224  4896.38   0.000     .1094365    .1095263
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
 super_opeid |      1194        1194           0    *|
        year |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store priv_q1

. 
. reghdfe par_rank `esvars_s', a(super_opeid year) vce(cl sfips)
(dropped 7 singleton observations)
(MWFE estimator converged in 5 iterations)
note: hs_cm6 omitted because of collinearity

HDFE Linear regression                            Number of obs   =     12,084
Absorbing 2 HDFE groups                           F(  11,     49) =      42.52
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.9734
                                                  Adj R-squared   =     0.9705
                                                  Within R-sq.    =     0.0004
Number of clusters (sfips)   =         50         Root MSE        =     0.0238

                                 (Std. err. adjusted for 50 clusters in sfips)
------------------------------------------------------------------------------
             |               Robust
    par_rank | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      hs_cm6 |          0  (omitted)
      hs_cm5 |   .0015729   .0016458     0.96   0.344    -.0017345    .0048804
      hs_cm4 |   .0090426   .0015947     5.67   0.000     .0058379    .0122474
      hs_cm3 |   .0040979   .0008576     4.78   0.000     .0023744    .0058213
      hs_cm2 |   .0017866   .0011115     1.61   0.114    -.0004471    .0040204
       hs_c0 |   .0002425   .0007613     0.32   0.751    -.0012874    .0017724
       hs_c1 |  -.0019013   .0008569    -2.22   0.031    -.0036232   -.0001793
       hs_c2 |   .0018058   .0012047     1.50   0.140    -.0006153    .0042268
       hs_c3 |  -.0047321    .001437    -3.29   0.002    -.0076198   -.0018444
       hs_c4 |   .0021412   .0018019     1.19   0.240    -.0014799    .0057622
       hs_c5 |   .0005027   .0019587     0.26   0.799    -.0034334    .0044388
       hs_c6 |  -.0021774    .002149    -1.01   0.316     -.006496    .0021413
       _cons |   .6083917   .0000216  2.8e+04   0.000     .6083483     .608435
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
 super_opeid |      1194        1194           0    *|
        year |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store priv_rank

. 
. local eskeep_s  "hs_cm5 hs_cm4 hs_cm3 hs_cm2 hs_c0 hs_c1 hs_c2 hs_c3 hs_c4 hs_c5"

. local esrename_s `"hs_cm5="-5" hs_cm4="-4" hs_cm3="-3" hs_cm2="-2" hs_c0="0" hs_c1="1" hs_c2="2" hs_c3="3" hs_c4="4" hs_c5="5""'

. local esorder_s  "hs_cm5 hs_cm4 hs_cm3 hs_cm2 hs_c0 hs_c1 hs_c2 hs_c3 hs_c4 hs_c5"

. 
. * ── Figure 3: par_q1 public vs private ──
. coefplot (pub_q1, label("Public") mcolor(navy) msymbol(circle) msize(small) ///
>               ciopts(lcolor(navy%50) lwidth(medthin))) ///
>          (priv_q1, label("Private") mcolor(cranberry) msymbol(square) msize(small) ///
>               ciopts(lcolor(cranberry%50) lwidth(medthin))), ///
>     keep(`eskeep_s') vertical ///
>     rename(`esrename_s') order(`esorder_s') ///
>     yline(0, lcolor(gs12) lwidth(thin)) ///
>     xline(4.5, lpattern(dash) lcolor(gs10) lwidth(thin)) ///
>     title("Public vs Private — Independent Regressions", size(medium)) ///
>     subtitle("Tennessee HOPE Scholarship", size(small)) ///
>     ytitle("Average causal effect") xtitle("Periods since treatment") ///
>     legend(order(2 "Public" 4 "Private") rows(1) region(style(none)) size(small)) ///
>     graphregion(color(white)) bgcolor(white) ///
>     ylabel(, angle(horizontal) format(%9.3f))

. 
. graph export "pubpriv_par_q1.pdf", replace
file /Users/tylersotomayor/dataverse_files/pubpriv_par_q1.pdf saved as PDF format

. graph drop _all

. 
. * ── Figure 4: par_rank public vs private ──
. coefplot (pub_rank, label("Public") mcolor(navy) msymbol(circle) msize(small) ///
>               ciopts(lcolor(navy%50) lwidth(medthin))) ///
>          (priv_rank, label("Private") mcolor(cranberry) msymbol(square) msize(small) ///
>               ciopts(lcolor(cranberry%50) lwidth(medthin))), ///
>     keep(`eskeep_s') vertical ///
>     rename(`esrename_s') order(`esorder_s') ///
>     yline(0, lcolor(gs12) lwidth(thin)) ///
>     xline(4.5, lpattern(dash) lcolor(gs10) lwidth(thin)) ///
>     title("Public vs Private — Independent Regressions", size(medium)) ///
>     subtitle("Tennessee HOPE Scholarship", size(small)) ///
>     ytitle("Average causal effect") xtitle("Periods since treatment") ///
>     legend(order(2 "Public" 4 "Private") rows(1) region(style(none)) size(small)) ///
>     graphregion(color(white)) bgcolor(white) ///
>     ylabel(, angle(horizontal) format(%9.3f))

. 
. graph export "pubpriv_par_rank.pdf", replace
file /Users/tylersotomayor/dataverse_files/pubpriv_par_rank.pdf saved as PDF format

. graph drop _all

. 
. 
. ********************************************************************************
. *  SPECIFICATION 3: Geographic — TN Public vs Bordering States (incl. GA)
. *  KY=21, VA=51, NC=37, GA=13, AL=01, MS=28, AR=05, MO=29, TN=47
. ********************************************************************************
. 
. use `fulldata', clear

. keep if inlist(state, "TN", "KY", "VA", "NC", "GA") | ///
>         inlist(state, "AL", "MS", "AR", "MO")
(23,340 observations deleted)

. 
. * ── Figure 5: par_q1 ──
. reghdfe par_q1 `esvars', a(super_opeid year) vce(cl sfips)
(dropped 1 singleton observations)
(MWFE estimator converged in 5 iterations)
note: h_cm6 omitted because of collinearity
warning: missing F statistic; dropped variables due to collinearity or too few clusters

HDFE Linear regression                            Number of obs   =      5,590
Absorbing 2 HDFE groups                           F(  11,      8) =          .
Statistics robust to heteroskedasticity           Prob > F        =          .
                                                  R-squared       =     0.9454
                                                  Adj R-squared   =     0.9395
                                                  Within R-sq.    =     0.0076
Number of clusters (sfips)   =          9         Root MSE        =     0.0238

                                  (Std. err. adjusted for 9 clusters in sfips)
------------------------------------------------------------------------------
             |               Robust
      par_q1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       h_cm6 |          0  (omitted)
       h_cm5 |   .0086238   .0027642     3.12   0.014     .0022495    .0149981
       h_cm4 |     .00193   .0021033     0.92   0.386    -.0029201    .0067802
       h_cm3 |   .0037772   .0019652     1.92   0.091    -.0007546     .008309
       h_cm2 |   .0005669   .0012191     0.46   0.654    -.0022443    .0033781
        h_c0 |   .0047841   .0011308     4.23   0.003     .0021765    .0073918
        h_c1 |    .005415    .002267     2.39   0.044     .0001872    .0106427
        h_c2 |   .0124425    .002302     5.41   0.001     .0071342    .0177508
        h_c3 |   .0140043   .0029839     4.69   0.002     .0071234    .0208853
        h_c4 |    .011726    .002865     4.09   0.003     .0051192    .0183327
        h_c5 |   .0193308   .0026465     7.30   0.000     .0132279    .0254336
        h_c6 |   .0320796    .003345     9.59   0.000      .024366    .0397932
       _cons |   .1549458   .0000875  1770.86   0.000      .154744    .1551476
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
 super_opeid |       519         519           0    *|
        year |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. 
. coefplot, keep(`eskeep') vertical ///
>     rename(`esrename') order(`esorder') ///
>     yline(0, lcolor(gs12) lwidth(thin)) ///
>     xline(4.5, lpattern(dash) lcolor(gs10) lwidth(thin)) ///
>     title("Treated: TN Public, Control: Bordering States", size(medium)) ///
>     subtitle("Tennessee HOPE Scholarship — Clustered by State", size(small)) ///
>     ytitle("Average causal effect") xtitle("Periods since treatment") ///
>     mcolor(navy) msymbol(circle) msize(small) ///
>     ciopts(lcolor(navy%50) lwidth(medthin)) ///
>     graphregion(color(white)) bgcolor(white) ///
>     ylabel(, angle(horizontal) format(%9.3f))

. 
. graph export "neighbor_par_q1.pdf", replace
file /Users/tylersotomayor/dataverse_files/neighbor_par_q1.pdf saved as PDF format

. graph drop _all

. 
. * ── Figure 6: par_rank ──
. reghdfe par_rank `esvars', a(super_opeid year) vce(cl sfips)
(dropped 1 singleton observations)
(MWFE estimator converged in 5 iterations)
note: h_cm6 omitted because of collinearity
warning: missing F statistic; dropped variables due to collinearity or too few clusters

HDFE Linear regression                            Number of obs   =      5,590
Absorbing 2 HDFE groups                           F(  11,      8) =          .
Statistics robust to heteroskedasticity           Prob > F        =          .
                                                  R-squared       =     0.9775
                                                  Adj R-squared   =     0.9751
                                                  Within R-sq.    =     0.0071
Number of clusters (sfips)   =          9         Root MSE        =     0.0205

                                  (Std. err. adjusted for 9 clusters in sfips)
------------------------------------------------------------------------------
             |               Robust
    par_rank | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       h_cm6 |          0  (omitted)
       h_cm5 |   -.001837    .003312    -0.55   0.594    -.0094744    .0058004
       h_cm4 |   .0024274   .0028003     0.87   0.411    -.0040301    .0088848
       h_cm3 |  -.0018241   .0017883    -1.02   0.338    -.0059479    .0022998
       h_cm2 |   .0016088   .0011052     1.46   0.184    -.0009398    .0041573
        h_c0 |  -.0035195   .0007088    -4.97   0.001    -.0051541    -.001885
        h_c1 |  -.0080816   .0014906    -5.42   0.001    -.0115189   -.0046443
        h_c2 |   -.007497   .0019203    -3.90   0.005    -.0119253   -.0030687
        h_c3 |  -.0094068   .0029066    -3.24   0.012    -.0161094   -.0027041
        h_c4 |  -.0098519   .0031779    -3.10   0.015    -.0171802   -.0025236
        h_c5 |  -.0160786   .0030684    -5.24   0.001    -.0231542   -.0090029
        h_c6 |  -.0240769   .0032912    -7.32   0.000    -.0316665   -.0164872
       _cons |   .5335045   .0000778  6854.01   0.000      .533325     .533684
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
 super_opeid |       519         519           0    *|
        year |        12           1          11     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. 
. coefplot, keep(`eskeep') vertical ///
>     rename(`esrename') order(`esorder') ///
>     yline(0, lcolor(gs12) lwidth(thin)) ///
>     xline(4.5, lpattern(dash) lcolor(gs10) lwidth(thin)) ///
>     title("Treated: TN Public, Control: Bordering States", size(medium)) ///
>     subtitle("Tennessee HOPE Scholarship — Clustered by State", size(small)) ///
>     ytitle("Average causal effect") xtitle("Periods since treatment") ///
>     mcolor(navy) msymbol(circle) msize(small) ///
>     ciopts(lcolor(navy%50) lwidth(medthin)) ///
>     graphregion(color(white)) bgcolor(white) ///
>     ylabel(, angle(horizontal) format(%9.3f))

. 
. graph export "neighbor_par_rank.pdf", replace
file /Users/tylersotomayor/dataverse_files/neighbor_par_rank.pdf saved as PDF format

. graph drop _all

. 
. di _n "All 6 figures exported."

All 6 figures exported.

. 
end of do-file

